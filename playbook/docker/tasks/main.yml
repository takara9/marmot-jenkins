# Master と Workerで共通のタスク
#- debug: msg="{{ ansible_facts }}"

##  Docker & Java のインストール
- name: Add Docker GPG key
  apt_key: url=https://download.docker.com/linux/ubuntu/gpg

- name: Add Docker APT repository
  apt_repository:
    repo: deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ansible_distribution_release}} stable

- name: Add Java APT repository
  apt_repository:
    repo: ppa:openjdk-r/ppa 
      
- name: Install a list of packages
  apt:
    name: "{{ packages }}"
    state: present
    update_cache: yes
  vars:
    packages:
    - apt-transport-https
    - ca-certificates
    - curl
    - software-properties-common
    - nfs-common
    - docker-ce{{ docker_version_ubuntu }}
    - software-properties-common
    - openjdk-8-jdk


- name: Add the user 'vagrant' with a specific uid and a primary group of 'docker'
  user:
    name: vagrant
    comment: docker exection user
    group: docker

- name: Start dockerd
  systemd:
    name: docker
    state: started
    enabled: yes

- name: Set sysctl 
  sysctl:
    name: net.bridge.bridge-nf-call-iptables
    value: "1"
    sysctl_set: yes
    sysctl_file: /etc/sysctl.conf      
    state: present
    reload: yes

- name: chmod 0666 /var/run/docker.sock
  file:
    path: "/var/run/docker.sock"
    owner: root
    group: root
    mode: '0666'


